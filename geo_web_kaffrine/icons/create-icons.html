<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G√©n√©rateur d'Ic√¥nes PWA - Web GIS Kaffrine</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            color: white;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }
        h1 { font-size: 2.5rem; margin-bottom: 10px; }
        .subtitle { font-size: 1.2rem; opacity: 0.9; margin-bottom: 40px; }
        .icons-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin: 40px 0;
        }
        .icon-card {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.2);
        }
        .icon-preview {
            background: white;
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .icon-label {
            font-weight: 600;
            font-size: 1rem;
        }
        .btn-generate {
            background: white;
            color: #667eea;
            border: none;
            padding: 20px 50px;
            font-size: 1.3rem;
            font-weight: 700;
            border-radius: 50px;
            cursor: pointer;
            margin: 30px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }
        .btn-generate:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 15px 40px rgba(0,0,0,0.4);
        }
        .progress-bar {
            width: 100%;
            height: 30px;
            background: rgba(255,255,255,0.2);
            border-radius: 15px;
            overflow: hidden;
            margin: 30px 0;
            display: none;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #fff, #e0e0ff);
            width: 0%;
            transition: width 0.3s ease;
        }
        .status {
            font-size: 1.1rem;
            margin-top: 20px;
            min-height: 30px;
        }
        .instructions {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 25px;
            margin-top: 40px;
            text-align: left;
        }
        .instructions h3 { margin-top: 0; }
        .instructions ol { line-height: 1.8; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé® G√©n√©rateur d'Ic√¥nes PWA</h1>
        <p class="subtitle">Cr√©ez les ic√¥nes n√©cessaires pour installer l'application sur mobile</p>

        <div class="progress-bar" id="progressBar">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <div class="status" id="status">Cliquez sur le bouton ci-dessous pour g√©n√©rer les ic√¥nes</div>

        <button class="btn-generate" onclick="generateIcons()">
            üì¶ G√©n√©rer et T√©l√©charger les Ic√¥nes
        </button>

        <div class="icons-grid" id="iconsGrid"></div>

        <div class="instructions">
            <h3>üìã Instructions d'installation :</h3>
            <ol>
                <li>Cliquez sur le bouton "G√©n√©rer et T√©l√©charger" ci-dessus</li>
                <li>D√©compressez le fichier ZIP t√©l√©charg√©</li>
                <li>Copiez tous les fichiers PNG dans le dossier <code>/icons/</code></li>
                <li>Rechargez l'application et essayez d'installer √† nouveau</li>
            </ol>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script>
        const sizes = [72, 96, 128, 144, 152, 192, 384, 512];
        
        function generateSVG(size) {
            return `<?xml version="1.0" encoding="UTF-8"?>
<svg width="${size}" height="${size}" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
    </linearGradient>
  </defs>
  <circle cx="50" cy="50" r="48" fill="url(#grad)"/>
  <circle cx="50" cy="50" r="38" fill="none" stroke="white" stroke-width="3"/>
  <path d="M50 25 L55 45 L75 50 L55 55 L50 75 L45 55 L25 50 L45 45 Z" fill="white"/>
  <circle cx="50" cy="50" r="8" fill="#333"/>
</svg>`;
        }

        async function svgToPng(svgString, size) {
            return new Promise((resolve, reject) => {
                const canvas = document.createElement('canvas');
                canvas.width = size;
                canvas.height = size;
                const ctx = canvas.getContext('2d');
                
                const img = new Image();
                const svgBlob = new Blob([svgString], {type: 'image/svg+xml;charset=utf-8'});
                const url = URL.createObjectURL(svgBlob);
                
                img.onload = function() {
                    ctx.drawImage(img, 0, 0, size, size);
                    URL.revokeObjectURL(url);
                    canvas.toBlob(blob => {
                        resolve(blob);
                    }, 'image/png');
                };
                
                img.onerror = function() {
                    reject(new Error('Failed to load SVG'));
                };
                
                img.src = url;
            });
        }

        async function generateIcons() {
            const btn = document.querySelector('.btn-generate');
            const status = document.getElementById('status');
            const progressBar = document.getElementById('progressBar');
            const progressFill = document.getElementById('progressFill');
            const iconsGrid = document.getElementById('iconsGrid');
            
            btn.disabled = true;
            btn.textContent = '‚è≥ G√©n√©ration en cours...';
            progressBar.style.display = 'block';
            iconsGrid.innerHTML = '';
            
            const zip = new JSZip();
            let completed = 0;
            
            for (const size of sizes) {
                try {
                    status.textContent = `G√©n√©ration de l'ic√¥ne ${size}x${size}...`;
                    
                    const svg = generateSVG(size);
                    const pngBlob = await svgToPng(svg, size);
                    
                    // Ajouter au ZIP
                    zip.file(`icon-${size}x${size}.png`, pngBlob);
                    
                    // Cr√©er l'aper√ßu
                    const url = URL.createObjectURL(pngBlob);
                    const card = document.createElement('div');
                    card.className = 'icon-card';
                    card.innerHTML = `
                        <div class="icon-preview">
                            <img src="${url}" width="${Math.min(size, 100)}" height="${Math.min(size, 100)}" alt="Icon ${size}x${size}">
                        </div>
                        <div class="icon-label">${size}x${size}</div>
                    `;
                    iconsGrid.appendChild(card);
                    
                    completed++;
                    progressFill.style.width = `${(completed / sizes.length) * 100}%`;
                    
                } catch (error) {
                    console.error(`Erreur pour ${size}x${size}:`, error);
                    status.textContent = `‚ùå Erreur pour ${size}x${size}: ${error.message}`;
                }
            }
            
            // T√©l√©charger le ZIP
            status.textContent = 'Cr√©ation du fichier ZIP...';
            const zipBlob = await zip.generateAsync({type: 'blob'});
            const zipUrl = URL.createObjectURL(zipBlob);
            
            const link = document.createElement('a');
            link.href = zipUrl;
            link.download = 'web-gis-icons.zip';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            status.innerHTML = '‚úÖ <strong>T√©l√©chargement termin√© !</strong><br>Extraisez le ZIP dans le dossier /icons/';
            btn.textContent = 'üì¶ Reg√©n√©rer les Ic√¥nes';
            btn.disabled = false;
        }

        // G√©n√©rer l'aper√ßu au chargement
        window.onload = () => {
            const iconsGrid = document.getElementById('iconsGrid');
            sizes.forEach(size => {
                const svg = generateSVG(100);
                const card = document.createElement('div');
                card.className = 'icon-card';
                card.innerHTML = `
                    <div class="icon-preview" style="padding: 10px;">
                        <svg width="${Math.min(size, 80)}" height="${Math.min(size, 80)}" viewBox="0 0 100 100">
                            <defs>
                                <linearGradient id="grad${size}" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
                                </linearGradient>
                            </defs>
                            <circle cx="50" cy="50" r="48" fill="url(#grad${size})"/>
                            <circle cx="50" cy="50" r="38" fill="none" stroke="white" stroke-width="3"/>
                            <path d="M50 25 L55 45 L75 50 L55 55 L50 75 L45 55 L25 50 L45 45 Z" fill="white"/>
                            <circle cx="50" cy="50" r="8" fill="#333"/>
                        </svg>
                    </div>
                    <div class="icon-label">${size}x${size}</div>
                `;
                iconsGrid.appendChild(card);
            });
        };
    </script>
</body>
</html>
